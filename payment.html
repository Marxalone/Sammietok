<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Payment Verification</title>
  <style>
    :root {
      --primary: #4361ee;
      --success: #4cc9f0;
      --danger: #f72585;
      --dark: #212529;
      --light: #f8f9fa;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Poppins', sans-serif;
    }
    
    body {
      background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
      min-height: 100vh;
      padding: 2rem;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    .payment-container {
      width: 100%;
      max-width: 600px;
    }
    
    .payment-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      overflow: hidden;
      transition: transform 0.3s ease;
    }
    
    .payment-card:hover {
      transform: translateY(-5px);
    }
    
    .payment-header {
      background: var(--primary);
      color: white;
      padding: 1.5rem;
      text-align: center;
    }
    
    .payment-header h2 {
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    
    .payment-details {
      background: var(--light);
      padding: 1.5rem;
      margin: 1rem;
      border-radius: 8px;
      position: relative;
    }
    
    .payment-details h3 {
      color: var(--dark);
      margin-bottom: 1rem;
      font-size: 1.1rem;
    }
    
    .payment-details p {
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .copy-btn {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: var(--primary);
      color: white;
      border: none;
      padding: 0.25rem 0.75rem;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.25rem;
      font-size: 0.8rem;
      transition: all 0.2s;
    }
    
    .copy-btn:hover {
      background: #3a56d4;
    }
    
    .copy-btn.copied {
      background: var(--success);
    }
    
    .payment-form {
      padding: 1.5rem;
    }
    
    .form-group {
      margin-bottom: 1.25rem;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--dark);
    }
    
    .form-control {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 1rem;
      transition: border-color 0.3s;
    }
    
    .form-control:focus {
      outline: none;
      border-color: var(--primary);
    }
    
    .submit-btn {
      width: 100%;
      padding: 0.75rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .submit-btn:hover {
      background: #3a56d4;
    }
    
    .submit-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    .status-message {
      margin-top: 1.5rem;
      padding: 1rem;
      border-radius: 6px;
      text-align: center;
      font-weight: 500;
    }
    
    .status-success {
      background: rgba(76, 201, 240, 0.1);
      color: var(--success);
      border: 1px solid var(--success);
    }
    
    .status-error {
      background: rgba(247, 37, 133, 0.1);
      color: var(--danger);
      border: 1px solid var(--danger);
    }
    
    .status-loading {
      background: rgba(67, 97, 238, 0.1);
      color: var(--primary);
      border: 1px solid var(--primary);
    }
    
    .loader {
      display: inline-block;
      width: 1rem;
      height: 1rem;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
      margin-right: 0.5rem;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="payment-container">
    <div class="payment-card">
      <div class="payment-header">
        <h2>Upload Your Payment Receipt</h2>
        <p>Complete your account purchase</p>
      </div>
      
      <div class="payment-details">
        <h3>Pay to UBA Bank</h3>
        <p><span>üè¶</span> <strong>Bank:</strong> United Bank for Africa (UBA)</p>
        <p><span>üí≥</span> <strong>Account Number:</strong> <span id="account-number">2350538653</span></p>
        <p><span>üë§</span> <strong>Account Name:</strong> <span id="account-name">Ebieobari Samuel Sunny</span></p>
        <button class="copy-btn" id="copy-btn">
          <span class="copy-text">Copy Details</span>
        </button>
      </div>
      
      <form id="paymentForm" class="payment-form">
        <div class="form-group">
          <label for="accountType">Account Type</label>
          <select id="accountType" class="form-control" required>
            <option value="">Select account type...</option>
            <option value="Fresh UK">Fresh UK Account (‚Ç¶5,000)</option>
            <option value="Old UK">Old UK Account (‚Ç¶10,000)</option>
            <option value="Fresh USA">Fresh USA Account (‚Ç¶5,000)</option>
            <option value="Old USA">Old USA Account (‚Ç¶10,000)</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="quantity">Quantity</label>
          <input type="number" id="quantity" class="form-control" min="1" value="1" required>
        </div>
        
        <div class="form-group">
          <label for="email">Email Address</label>
          <input type="email" id="email" class="form-control" required>
        </div>
        
        <div class="form-group">
          <label for="receipt">Upload Receipt (Image)</label>
          <input type="file" id="receipt" class="form-control" accept="image/*" required>
        </div>
        
        <button type="submit" class="submit-btn" id="submit-btn">
          Verify Payment
        </button>
        
        <div id="status-message" class="status-message" style="display: none;"></div>
      </form>
    </div>
  </div>

  <script>
    // Price mapping
    const PRICES = {
      "Fresh UK": 5000,
      "Old UK": 10000,
      "Fresh USA": 5000,
      "Old USA": 10000
    };

    // DOM elements
    const paymentForm = document.getElementById('paymentForm');
    const statusMessage = document.getElementById('status-message');
    const copyBtn = document.getElementById('copy-btn');
    const submitBtn = document.getElementById('submit-btn');
    const accountNumber = document.getElementById('account-number');
    const accountName = document.getElementById('account-name');

    // Copy account details
    copyBtn.addEventListener('click', () => {
      const textToCopy = `Bank: UBA\nAccount Number: ${accountNumber.textContent}\nAccount Name: ${accountName.textContent}`;
      
      navigator.clipboard.writeText(textToCopy).then(() => {
        copyBtn.innerHTML = '‚úì Copied!';
        copyBtn.classList.add('copied');
        
        setTimeout(() => {
          copyBtn.innerHTML = '<span class="copy-text">Copy Details</span>';
          copyBtn.classList.remove('copied');
        }, 2000);
      });
    });

    // Payment verification
    paymentForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // Get form values
      const accountType = document.getElementById("accountType").value;
      const quantity = parseInt(document.getElementById("quantity").value);
      const email = document.getElementById("email").value;
      const receipt = document.getElementById("receipt").files[0];
      
      // Validation
      if (!accountType || !email || quantity < 1 || !receipt) {
        showStatus("Please fill all fields and upload a receipt", "error");
        return;
      }
      
      const expectedAmount = PRICES[accountType] * quantity;
      submitBtn.disabled = true;
      showStatus("Uploading and verifying receipt...", "loading");
      
      try {
        // 1. Upload receipt
        const formData = new FormData();
        formData.append('files[]', receipt);
        
        const uploadRes = await fetch('https://uguu.se/upload', {
          method: 'POST',
          body: formData
        });
        
        const uploadData = await uploadRes.json();
        const receiptUrl = uploadData.files[0].url;
        
        // 2. Prepare AI verification prompt
        const today = new Date();
        const dateString = today.toLocaleDateString('en-GB');
        
        const prompt = `
        STRICT PAYMENT VERIFICATION:
        Confirm ALL conditions are met in the receipt:
        1. Amount: ‚Ç¶${expectedAmount} (exact)
        2. Recipient Name: "Ebieobari Samuel Sunny"
        3. Bank: UBA (Account: 2350538653)
        4. Date: ${dateString}
        5. Currency: NGN
        6. Transaction Reference visible

        Reply ONLY:
        - "APPROVED" if ALL are correct
        - "REJECTED: [Reason]" if any fail
        `;
        
        // 3. Call MarxAI API
        const sessionCookie = await getMarxAISession();
        const headers = {
          "content-type": "application/json",
          "cookie": `editeecom_session=${sessionCookie}`,
          "x-requested-with": "XMLHttpRequest"
        };
        
        const aiResponse = await fetch("https://editee.com/submit/chatgptfree", {
          method: "POST",
          headers,
          body: JSON.stringify({
            context: " ",
            selected_model: "gemini",
            important: "aV77OsKy",
            user_input: `${prompt}\n\nReceipt URL: ${receiptUrl}`
          })
        });
        
        const aiData = await aiResponse.json();
        const verificationResult = aiData.text.trim();
        
        // 4. Handle response
        if (verificationResult.includes("APPROVED")) {
          showStatus("Payment verified successfully! Preparing your account...", "success");
          
          // Save order info
          localStorage.setItem('orderInfo', JSON.stringify({ 
            accountType, 
            quantity,
            email,
            verifiedAt: new Date().toISOString()
          }));
          
          // Redirect after delay
          setTimeout(() => {
            window.location.href = 'success.html';
          }, 3000);
        } else {
          const reason = verificationResult.replace("REJECTED:", "").trim();
          showStatus(`Payment declined: ${reason || "Invalid receipt"}`, "error");
        }
        
        // Save review data
        localStorage.setItem('lastReceiptReview', JSON.stringify({
          url: receiptUrl,
          aiResponse: verificationResult,
          time: new Date().toISOString()
        }));
        
      } catch (error) {
        console.error("Verification error:", error);
        showStatus("Error verifying payment. Please try again.", "error");
      } finally {
        submitBtn.disabled = false;
      }
    });
    
    // Helper functions
    async function getMarxAISession() {
      const res = await fetch("https://editee.com/chat-gpt");
      const cookie = res.headers.get('set-cookie');
      return cookie ? cookie.split(';')[0].split('=')[1] : null;
    }
    
    function showStatus(message, type) {
      statusMessage.textContent = message;
      statusMessage.style.display = "block";
      statusMessage.className = `status-message status-${type}`;
      
      if (type === "loading") {
        statusMessage.innerHTML = `
          <span class="loader"></span> ${message}
        `;
      }
    }
  </script>
</body>
</html>