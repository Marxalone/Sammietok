<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Payment Verification</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f2f2f2;
      padding: 30px;
    }
    .payment-form {
      background: white;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0px 0px 15px rgba(0,0,0,0.1);
      max-width: 500px;
      margin: auto;
    }
    .form-input {
      margin-bottom: 15px;
    }
    .form-input label {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .form-input input, .form-input select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    #status-message {
      margin-top: 20px;
      font-weight: bold;
    }
  </style>
</head>
<body>

<div class="payment-form">
  <h2>Upload Your Payment Receipt</h2>
  <form id="paymentForm">
    <div class="form-input">
      <label for="accountType">Select Account Type</label>
      <select id="accountType" required>
        <option value="">Choose...</option>
        <option value="Fresh">Fresh UK Account</option>
        <option value="Old">Old UK Account</option>
      </select>
    </div>
    <div class="form-input">
      <label for="quantity">Quantity</label>
      <input type="number" id="quantity" min="1" required>
    </div>
    <div class="form-input">
      <label for="email-address">Email Address</label>
      <input type="email" id="email-address" required>
    </div>
    <div class="form-input">
      <label for="receipt-upload">Upload Receipt Image</label>
      <input type="file" id="receipt-upload" accept="image/*" required>
    </div>
    <button type="submit">Verify Payment</button>
  </form>
  
  <div id="status-message"></div>
</div>
<script>
// Secret Admin Panel Trigger + Password
document.addEventListener('keydown', function(event) {
  if (event.shiftKey && event.key.toLowerCase() === 'a') {
    const password = prompt('Enter Admin Password:');
    if (password === 'marxisgod2025') { // Change this password to anything you want
      openAdminPanel();
    } else {
      alert('Wrong password. Access denied!');
    }
  }
});

function openAdminPanel() {
  const records = JSON.parse(localStorage.getItem('lastReceiptReview'));
  if (!records) {
    alert('No review data found.');
    return;
  }

  const win = window.open('', '_blank');
  win.document.write(`
    <html>
      <head>
        <title>Admin Panel - Receipt Reviews</title>
        <style>
          body { font-family: 'Poppins', sans-serif; background: #f2f2f2; padding: 20px; }
          .record { background: white; padding: 15px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0px 0px 10px rgba(0,0,0,0.1); }
          img { max-width: 100%; border-radius: 5px; margin-top: 10px; }
          .approve-btn, .ban-btn { margin-top: 10px; padding: 8px 12px; border: none; cursor: pointer; border-radius: 5px; }
          .approve-btn { background: green; color: white; }
          .ban-btn { background: red; color: white; margin-left: 10px; }
        </style>
      </head>
      <body>
        <h2>Admin Panel: Payment Reviews</h2>
        <div class="record">
          <strong>AI Decision:</strong> ${records.aiResponse}<br>
          <strong>Upload Time:</strong> ${new Date(records.time).toLocaleString()}<br>
          <img src="${records.url}" alt="Receipt">
          <div>
            <button class="approve-btn" onclick="alert('✅ Approved manually!')">✅ Approve</button>
            <button class="ban-btn" onclick="alert('⛔ Banned manually!')">⛔ Ban</button>
          </div>
        </div>
      </body>
    </html>
  `);
}
</script>
<script>
const paymentForm = document.getElementById('paymentForm');
const statusMessage = document.getElementById('status-message');

paymentForm.addEventListener('submit', async function(e) {
  e.preventDefault();

  let accountType = document.getElementById("accountType").value;
  let quantity = parseInt(document.getElementById("quantity").value);
  let email = document.getElementById("email-address").value;
  let receipt = document.getElementById("receipt-upload").files[0];

  if (!accountType || !email || quantity < 1 || !receipt) {
    statusMessage.innerHTML = "<span style='color:red;'>❌ Please fill all fields and upload a receipt.</span>";
    return;
  }

  statusMessage.innerHTML = "⏳ Uploading and verifying your receipt, please wait...";

  const formData = new FormData();
  formData.append('files[]', receipt);

  try {
    const uploadRes = await fetch('https://uguu.se/upload', {
      method: 'POST',
      body: formData
    });
    const uploadData = await uploadRes.json();
    const receiptUrl = uploadData.files[0].url;

    const expectedAmount = (accountType === "Fresh" ? 5000 : 10000) * quantity;
    const today = new Date();
    const dateString = today.toLocaleDateString('en-GB'); // 02/05/2025

    const question = `
You are a strict payment verification AI.
Carefully inspect the attached receipt and check:

- Was exactly ₦${expectedAmount} paid (no more, no less, not even ₦1 difference)?
- Is the payment to "Sammie Store"?
- Was the transaction made today (${dateString})?
- Is the currency Nigerian Naira (NGN)?
- Is the receipt clear and readable (not blurry)?
- Does the receipt contain a transaction Reference Number?

If ALL are TRUE, reply only: PASS.
If ANY are FALSE, reply: FAIL - [explain reason shortly].
`;

    const apiURL = `https://api.hiuraa.my.id/ai/gemini-advanced?text=${encodeURIComponent(question)}&_mediaUrl=${encodeURIComponent(receiptUrl)}&sessionid=${Date.now()}`;

    const aiRes = await fetch(apiURL);
    const aiData = await aiRes.json();

    if (!aiData || !aiData.result) {
      throw new Error('No response from AI.');
    }

    const aiResult = aiData.result.toLowerCase();

    // Save receipt + AI response (optional for admin record)
    localStorage.setItem('lastReceiptReview', JSON.stringify({
      url: receiptUrl,
      aiResponse: aiData.result,
      time: new Date().toISOString()
    }));

    if (aiResult.includes('pass')) {
      statusMessage.innerHTML = "<span style='color:green;'>✅ Payment verified successfully! Preparing your account...</span>";

      // Save order info
      localStorage.setItem('orderInfo', JSON.stringify({ accountType, quantity }));

      setTimeout(() => {
        window.location.href = 'success.html';
      }, 3000);
    } else {
      statusMessage.innerHTML = `<span style='color:red;'>❌ Payment Declined: ${aiData.result}</span>`;
    }

  } catch (error) {
    console.error('Verification Error:', error);
    statusMessage.innerHTML = "<span style='color:red;'>❌ Error verifying payment. Please try again later.</span>";
  }
});
</script>

</body>
</html>